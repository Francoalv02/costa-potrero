<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestión de Pagos - Costa Potrero</title>
    <link rel="stylesheet" href="../css/estilo.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script type="module" src="./js/pagos.js"></script>
</head>
<body>
    <header>
        <div class="logo">
            <h1 class="h1">Costa Potrero</h1>
            <button onclick="cerrarSesion()" class="btn-logout">Cerrar sesión</button>
        </div>
        <nav>
            <ul>
                <li> 
                    <a href="./../reservas/disponibilidad.html">Disponibilidad</a>
                    <a href="./../reservas/index.html">Listado Reservas</a>
                    <a href="./../cabanas/alta.html">Alta Cabaña</a>
                    <a href="./../cabanas/index.html">Listado Cabañas</a>
                    <a href="./../huespedes/index.html">Listado Huespedes</a>
                    <a href="./../pagos/pagos.html">Lista de Pagos</a>
                    <a href="./../solicitudes/index.html">Solicitudes</a>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Botón flotante de búsqueda -->
    <button id="btn-busqueda-flotante" class="btn-busqueda-flotante" title="Buscar Pago">
        <span class="btn-busqueda-texto">Buscar Pago</span>
    </button>

    <!-- Ventana emergente de búsqueda -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-busqueda">
            <button class="btn-cerrar-modal" id="btn-cerrar-modal">×</button>
                            <h3>Buscar Pago por ID</h3>
            <form id="form-buscar-pago" class="form-busqueda">
                <div class="form-group">
                    <label for="id_pago">ID de Pago:</label>
                    <input type="number" id="id_pago" name="id_pago" min="1" placeholder="Ej: 1, 2, 3..." required>
                </div>
                <button type="submit" class="btn-estadisticas">Buscar Pago</button>
            </form>
            <div id="resultado-busqueda" class="resultado-busqueda"></div>
        </div>
    </div>

    <!-- Ventana emergente de edición -->
    <div id="modal-editar-overlay" class="modal-overlay">
        <div class="modal-busqueda">
            <button class="btn-cerrar-modal" id="btn-cerrar-modal-editar">×</button>
            <h3>Editar Pago</h3>
            <form id="form-editar-pago" class="form-busqueda">
                <div class="form-row">
                    <div class="form-col">
                        <label for="editar-id_pago">ID de Pago:</label>
                        <input type="number" id="editar-id_pago" readonly>
                    </div>
                    <div class="form-col">
                        <label for="editar-id_reserva">ID de Reserva:</label>
                        <input type="number" id="editar-id_reserva" readonly>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="editar-estado_pago">Estado de Pago:</label>
                        <select id="editar-estado_pago" name="estado_pago" required>
                            <option value="">Seleccione un estado</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="editar-metodo_pago">Método de Pago:</label>
                        <select id="editar-metodo_pago" name="metodo_pago" required>
                            <option value="">Seleccione un método</option>
                            <option value="Efectivo">Efectivo</option>
                            <option value="Transferencia">Transferencia</option>
                            <option value="MercadoPago">Mercado Pago</option>
                            <option value="Tarjeta">Tarjeta</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label for="editar-observacion">Observación:</label>
                        <textarea id="editar-observacion" name="observacion" rows="3" placeholder="Observaciones adicionales..."></textarea>
                    </div>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn-estadisticas">Guardar Cambios</button>
                    <button type="button" id="btn-cancelar-editar" class="btn-estadisticas" style="background: #6c757d;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <main class="main-content">
        

        <!-- Sección 2: Grilla de Pagos -->
        <section class="section-grilla">
            <h2>Listado de Pagos</h2>
            <div id="mensajes"></div>

            <!-- Filtro de estado -->
            <div class="filtro-container">
                <label for="filtro-estado">Filtrar por Estado:</label>
                <select id="filtro-estado">
                    <option value="">Todos los estados</option>
                </select>
                <button id="btn-reporte-pagos" class="btn-estadisticas">Generar Reporte</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID Pago</th>
                        <th>ID Reserva</th>
                        <th>Huésped</th>
                        <th>Fecha Pago</th>
                        <th>Estado</th>
                        <th>Monto Total</th>
                        <th>Pago Restante</th>
                        <th>Método</th>
                        <th>Observación</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="tabla-pagos">
                    
                </tbody>
            </table>
        </section>

        <!-- Sección 3: Estadísticas y Gráficos -->
        <section class="section-estadisticas">
            <h2>Estadísticas y Gráficos</h2>
            <div class="estadisticas-container">
                <!-- Tarjetas de resumen -->
                <div class="tarjetas-resumen">
                    <div class="tarjeta">
                        <h3>Total de Pagos</h3>
                        <p id="total-pagos">0</p>
                    </div>
                    <div class="tarjeta">
                        <h3>Monto Pagado</h3>
                        <p id="monto-pagado">$0</p>
                    </div>
                    <div class="tarjeta">
                        <h3>Monto Restante</h3>
                        <p id="monto-restante">$0</p>
                    </div>
                    <div class="tarjeta">
                        <h3>Pago Total</h3>
                        <p id="pago-total">$0</p>
                    </div>
                </div>

                <!-- Gráficos -->
                <div class="graficos-container">
                    <div class="grafico-item">
                        <h3>Pagos por Estado</h3>
                        <canvas id="grafico-estados"></canvas>
                    </div>
                    <div class="grafico-item">
                        <h3>Pagos por Método</h3>
                        <canvas id="grafico-metodos"></canvas>
                    </div>
                </div>
            </div>

            <!-- Botones de acción -->
            <div class="acciones-container">
                <button id="btn-actualizar-estadisticas" class="btn-estadisticas">Actualizar Estadísticas</button>
                <button id="btn-exportar-estadisticas" class="btn-estadisticas">Exportar Estadísticas (PDF)</button>
            </div>
        </section>
    </main>

   <script>
  function cerrarSesion() {
    fetch('/logout', { method: 'POST' })
      .then(() => {
        window.location.href = '/login.html';
      })
      .catch(error => {
        console.error('Error al cerrar sesión:', error);
      });
  }
</script>

</body>
</html>
